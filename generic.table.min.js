!function(e){try{e=angular.module("generic.table")}catch(t){e=angular.module("generic.table",[])}e.run(["$templateCache",function(e){e.put("directive/generic-table/generic-table.html",'<div class="generic-table"><table class="table table-condensed table-hover table-sortable" ng-if="gtHasData"><thead><tr ng-class="::gtRowTransition ? \'fade-in animate\':\'\'"><th ng-repeat="field in ::gtFields | orderBy:\'columnOrder\' track by field.objectKey" ng-show=":gtRefresh:gtSettings | getProperty:field.objectKey:\'visible\'" ng-class=":gtRefresh:[field.classNames, (field.objectKey | camelToDash) + \'-column\', \'sort-\'+(gtSettings | getProperty:field.objectKey:\'sort\')]"><span ng-click=":gtRefresh:(gtSettings | getProperty:field.objectKey:\'sort\') === \'enable\' ? sort(field.objectKey):(gtSettings | getProperty:field.objectKey:\'sort\') === \'asc\' ? sort(field.objectKey):(gtSettings | getProperty:field.objectKey:\'sort\') === \'desc\' ? sort(field.objectKey):\'\'">{{::field.name}}</span></th></tr><tr ng-if="gtTotals" ng-class="::gtRowTransition ? \'fade-in animate\':\'\'"><td ng-repeat="field in ::gtFields | orderBy:\'columnOrder\' track by field.objectKey" class="total-column" ng-show=":gtRefresh:gtSettings | getProperty:field.objectKey:\'visible\'" ng-class="::[(gtFields | getProperty:field.objectKey:\'classNames\'), (field.objectKey | camelToDash) + \'-column\']" ng-bind-html="::gtFields | gtRender:gtTotals:field.objectKey"></td></tr></thead><tbody><tr ng-repeat="row in gtDisplayData | limitTo: displayRows" gt-event="" ng-class="::gtRowTransition ? \'fade-in animate\':\'\'"><td ng-repeat="field in ::gtFields | orderBy:\'columnOrder\' track by field.objectKey" ng-show=":gtRefresh:gtSettings | getProperty:field.objectKey:\'visible\'" ng-class="::[(gtFields | getProperty:field.objectKey:\'classNames\'), (field.objectKey | camelToDash) + \'-column\']"><span ng-class="::field.click ? \'gt-click-enabled\':\'\'" ng-bind-html="::gtFields | gtRender:row:field.objectKey" ng-click="::!field.click || field.click(row)"></span></td></tr></tbody><tr ng-if="pagination === false"><td class="gt-no-data" colspan="{{:gtRefresh:(gtSettings | filter:{\'visible\':true}:true).length}}">{{::gtNoDataTxt}}</td></tr></table><div class="gt-pagination text-center" ng-if="gtPagination === true && pagination !== false"><ul class="pagination"><li ng-class="{disabled: currentPage === 0}" ng-show="currentPage !== 0"><button class="btn-link link" ng-click="previousPage()" translate="ALL.GENERAL#PAGINATION_PREVIOUS#BUTTON" ng-disabled="currentPage === 0">« Prev</button></li><li ng-show="currentPage > 3"><button class="btn-link link" ng-click="setPage(0)">1</button><small>…</small></li><li style="display: inline;padding: 0 5px;" ng-repeat="page in pagination" ng-class="page === currentPage ? \'active\':\'\'"><button class="btn-link link" ng-click="setPage(page)">{{page+1}}</button></li><li ng-show="currentPage +1 < pages.length-1 && pages.length > 4"><small ng-show="currentPage + 3 < pages.length">…</small><button class="btn-link link" ng-click="setPage(pages.length-1)">{{pages.length}}</button></li><li ng-class="{disabled: currentPage == pages.length}" ng-show="currentPage+1 !== pages.length"><button class="btn-link link" ng-click="nextPage()" translate="ALL.GENERAL#PAGINATION_NEXT#BUTTON" ng-disabled="currentPage+1 === pages.length">Next »</button></li></ul></div></div>')}])}(),angular.module("generic.table").directive("genericTable",function(){return{restrict:"E",replace:!0,scope:{gtId:"=gtId",gtSettings:"=gtSettings",gtFields:"=gtFields",gtTotals:"=gtTotals",gtData:"=gtData",gtRows:"@gtRows",gtRowTransition:"@gtRowTransition",gtPagination:"@gtPagination",gtNoDataTxt:"@"},templateUrl:"directive/generic-table/generic-table.html",link:function(e,t,n,a){},controller:"genericTableController"}}).controller("genericTableController",["$scope","$filter","$timeout","CSV","$document",function(e,t,n,a,i){var r,o,g,l=[];e.gtPagination="undefined"==typeof e.gtPagination?!0:"false"!==e.gtPagination,e.gtRows="undefined"==typeof e.gtRows?20:e.gtRows,e.gtNoDataTxt="undefined"==typeof e.gtNoDataTxt?"No table data to display":e.gtNoDataTxt,e.gtId="undefined"==typeof e.gtId?e.$id:e.gtId,t("map")(e.gtSettings,function(n){try{t("filter")(e.gtFields,{objectKey:n.objectKey},!0)[0].columnOrder=n.columnOrder}catch(a){console.log('field definition object for property: "'+n.objectKey+'" not found.',a)}});var s=function(t){e.gtHasData=!1,r=t.slice(0),e.$emit("gt-started-data-processing",e.gtId),d(t)},c=function(t){e.gtHasData=!1,r=t.slice(0),e.$emit("gt-started-data-processing",e.gtId),d(t)},d=function(e){var t=e;u(t),t.length=0},u=function(n){var a=t("map")(t("filter")(e.gtSettings,{enabled:!0},!0),"objectKey");o=t("map")(n,function(n){var i={};return t("map")(a,function(a){if("undefined"!=typeof n[a])i[a]=n[a];else{var r=t("map")(t("filter")(e.gtFields,{objectKey:a},!0),"value")[0];r&&angular.isFunction(r)?i[a]=r(n):console.log('property: "'+a+'" does not exists in data object and no value function was declared')}}),i}),f()},f=function(){g=t("gtSort")(o,l),e.$broadcast("$$rebind::gtRefresh"),p()},p=function(){e.pages=t("chunkBy")(g,parseInt(e.gtRows)),e.currentPage=0,e.loading=!0,e.$emit("gt-started-rendering"),e.gtDisplayData=e.pages[e.currentPage],b(e.pages.length,e.currentPage),n(function(){e.$emit("gt-finished-data-processing",e.gtId),e.gtHasData=!0},200)};e.$on("gt-update-table:"+e.gtId,function(e,t){c(t)}),e.$on("gt-update-structure:"+e.gtId,function(t,n){e.gtFields=n.fields,e.gtSettings=n.settings}),e.$on("gt-paginate-table:"+e.gtId,function(t,n){e.gtRows=parseInt(n),p()}),e.$on("gt-export-csv:"+e.gtId,function(e,t){y(t)});var b=function(t,n){return e.pagination=[],0===t?void(e.pagination=!1):void(2>t?e.pagination=[0]:3>t?e.pagination=[0,1]:4>t?e.pagination=[0,1,2]:5>t?e.pagination=[0,1,2,3]:4>n?e.pagination=[0,1,2,3,4]:t>n+1?e.pagination=[n-1,n,n+1]:t===n+1?e.pagination=[n-2,n-1,n]:t-4>n&&(e.pagination=[n-1,n,n+1,n+2]))};e.nextPage=function(){try{e.currentPage++,b(e.pages.length,e.currentPage),e.$emit("gt-started-rendering",e.gtId),e.gtDisplayData=e.pages[e.currentPage]}catch(t){console.log(t)}},e.previousPage=function(){e.currentPage--,b(e.pages.length,e.currentPage),e.$emit("gt-started-rendering",e.gtId),e.gtDisplayData=e.pages[e.currentPage]},e.setPage=function(t){e.currentPage=t,b(e.pages.length,e.currentPage),e.$emit("gt-started-rendering",e.gtId),e.gtDisplayData=e.pages[e.currentPage]},e.sort=function(n){if(n)for(var a=0;e.gtSettings.length>a;a++){var i=e.gtSettings[a];if(i.objectKey===n){var r=i.sort;switch(r){case"disable":break;case"enable":e.gtSettings[a].sort="asc";break;case"asc":e.gtSettings[a].sort="desc";break;case"desc":e.gtSettings[a].sort="enable"}}}l=t("map")(t("filter")(e.gtSettings,{sort:"asc desc"},function(e,t){return t.indexOf(e)>-1}),function(e){return("desc"===e.sort?"-":"")+e.objectKey}),f()},e.gtData&&s(e.gtData);var y=function(r){r="undefined"==typeof r?{}:r;var o="undefined"==typeof r.fileName?"export":r.fileName,l=JSON.parse(angular.toJson(g.slice(0))),s={fieldSep:"undefined"==typeof r.fieldSep?";":r.fieldSep,header:t("map")(t("orderBy")(e.gtFields,"columnOrder"),"name"),txtDelim:"undefined"==typeof r.txtDelim?'"':r.txtDelim,columnOrder:t("map")(t("orderBy")(e.gtFields,"columnOrder"),"objectKey"),decimalSep:"undefined"==typeof r.decimalSep?",":r.decimalSep,addByteOrderMarker:"undefined"==typeof r.addBom,charset:"undefined"==typeof r.charset?"utf-8":r.charset};a.stringify(l,s).then(function(e){var t;if(window.navigator.msSaveOrOpenBlob)t=new Blob([e],{type:"text/csv;charset=utf-8;"}),navigator.msSaveBlob(t,"export.csv");else if("Microsoft Internet Explorer"===window.navigator.appName){window.alert("You're using an old version of Internet Explorer and the export might therefore have the wrong format, please update your browser.");var a=angular.element("<iframe></iframe>");a[0].style.display="none";var r=angular.element("body");r.append(a);var g=null;a[0].contentDocument?g=a[0].contentDocument:a[0].contentWindow&&(g=a[0].contentWindow.document),g.open("text/plain","replace"),g.write([e]),g.close(),g.execCommand("SaveAs",!0,o+".csv")}else{t=new Blob([e],{type:"text/csv;charset=utf-8;"});var l=angular.element("<a></a>");l.attr("href",window.URL.createObjectURL(t)),l.attr("download",o+".csv"),i.find("body").append(l),n(function(){l[0].click(),l.remove()},null)}})}}]).directive("gtEvent",function(){return{restrict:"A",link:function(e,t,n,a){e.$last&&e.$emit("gt-finished-rendering",e.gtId)}}}).filter("getProperty",["$filter",function(e){return function(t,n,a){try{var i=e("filter")(t,{objectKey:n},!0)[0][a]}catch(r){console.log('cannot read property: "'+a+'" on missing key: "'+n+'" in settings.',r)}return i}}]).filter("gtRender",["$filter",function(e){return function(t,n,a){var i;if(angular.isArray(t)){var r=e("filter")(t,{objectKey:a},!0)[0].render;i=r&&angular.isFunction(r)?r(n,a):n[a]}else i=n[a];return i}}]).filter("camelToDash",function(){return function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}).filter("gtSort",function(){return function(e,t){function n(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,a){var i=n[e]<a[e]?-1:n[e]>a[e]?1:0;return i*t}}function a(e){var t=e;return function(e,a){for(var i=0,r=0,o=t.length;0===r&&o>i;)r=n(t[i])(e,a),i++;return r}}return e.sort(a(t))}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdlbmVyaWMudGFibGUudHBsLmpzIiwiZ2VuZXJpYy10YWJsZS5qcyJdLCJuYW1lcyI6WyJlIiwiYW5ndWxhciIsIm1vZHVsZSIsInQiLCJydW4iLCJwdXQiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJzY29wZSIsImd0SWQiLCJndFNldHRpbmdzIiwiZ3RGaWVsZHMiLCJndFRvdGFscyIsImd0RGF0YSIsImd0Um93cyIsImd0Um93VHJhbnNpdGlvbiIsImd0UGFnaW5hdGlvbiIsImd0Tm9EYXRhVHh0IiwidGVtcGxhdGVVcmwiLCJsaW5rIiwiZWxlbWVudCIsImF0dHJzIiwiZm4iLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGZpbHRlciIsIiR0aW1lb3V0IiwiQ1NWIiwiJGRvY3VtZW50Iiwib3JpZ2luYWxEYXRhIiwibWFwcGVkRGF0YSIsInNvcnRlZERhdGEiLCJzb3J0aW5nIiwiJGlkIiwic2V0dGluZyIsIm9iamVjdEtleSIsImNvbHVtbk9yZGVyIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiaW5pdFRhYmxlIiwiaW5pdERhdGEiLCJndEhhc0RhdGEiLCJzbGljZSIsIiRlbWl0IiwiYXBwbHlGaWx0ZXIiLCJjaGFuZ2VEYXRhIiwibmV3RGF0YSIsImRhdGEiLCJmaWx0ZXJlZERhdGEiLCJtYXBLZXlzIiwibGVuZ3RoIiwicHJvcGVydGllcyIsImVuYWJsZWQiLCJyb3ciLCJvYmoiLCJwcm9wZXJ0eSIsInZhbHVlRnVuY3Rpb24iLCJpc0Z1bmN0aW9uIiwiYXBwbHlTb3J0IiwiJGJyb2FkY2FzdCIsImFwcGx5UGFnaW5hdGlvbiIsInBhZ2VzIiwicGFyc2VJbnQiLCJjdXJyZW50UGFnZSIsImxvYWRpbmciLCJndERpc3BsYXlEYXRhIiwicGFnaW5hdGlvbiIsIiRvbiIsImV2ZW50IiwiYXJnIiwiZmllbGRzIiwic2V0dGluZ3MiLCJndEV4cG9ydCIsInRvdGFsUGFnZXMiLCJuZXh0UGFnZSIsInByZXZpb3VzUGFnZSIsInNldFBhZ2UiLCJwYWdlIiwic29ydCIsImkiLCJleHBlY3RlZCIsImFjdHVhbCIsImluZGV4T2YiLCJvcHRpb25zIiwiZmlsZU5hbWUiLCJKU09OIiwicGFyc2UiLCJ0b0pzb24iLCJoZWFkZXJzIiwiZmllbGRTZXAiLCJoZWFkZXIiLCJ0eHREZWxpbSIsImRlY2ltYWxTZXAiLCJhZGRCeXRlT3JkZXJNYXJrZXIiLCJhZGRCb20iLCJjaGFyc2V0Iiwic3RyaW5naWZ5IiwidGhlbiIsInJlc3VsdCIsImJsb2IiLCJ3aW5kb3ciLCJuYXZpZ2F0b3IiLCJtc1NhdmVPck9wZW5CbG9iIiwiQmxvYiIsInR5cGUiLCJtc1NhdmVCbG9iIiwiYXBwTmFtZSIsImFsZXJ0IiwiaWZyYW1lIiwic3R5bGUiLCJkaXNwbGF5IiwiYXBwZW5kIiwiZG9jIiwiY29udGVudERvY3VtZW50IiwiY29udGVudFdpbmRvdyIsImRvY3VtZW50Iiwib3BlbiIsIndyaXRlIiwiY2xvc2UiLCJleGVjQ29tbWFuZCIsImRvd25sb2FkTGluayIsImF0dHIiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJmaW5kIiwiY2xpY2siLCJyZW1vdmUiLCIkbGFzdCIsImZpbHRlciIsImtleSIsIm91dHB1dCIsImlzQXJyYXkiLCJyZW5kZXJNZXRob2QiLCJyZW5kZXIiLCJzdHJpbmciLCJ0b0xvd2VyQ2FzZSIsImFycmF5IiwicHJvcGVydHlBcnJheSIsImR5bmFtaWNTb3J0Iiwic29ydE9yZGVyIiwic3Vic3RyIiwiYSIsImIiLCJkeW5hbWljU29ydE11bHRpcGxlIiwicHJvcHMiLCJvYmoxIiwib2JqMiIsIm51bWJlck9mUHJvcGVydGllcyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsR0FBQSxJQUFBQSxFQUFBQyxRQUFBQyxPQUFBLGlCQUFBLE1BQUFDLEdBQUFILEVBQUFDLFFBQUFDLE9BQUEsb0JBQUFGLEVBQUFJLEtBQUEsaUJBQUEsU0FBQUosR0FBQUEsRUFBQUssSUFBQSw2Q0FBQSxtcEdDa0JBSixRQUFBQyxPQUFBLGlCQUFBSSxVQUFBLGVB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cUYsT0FBQSxJQUVBLFNBQUFDLEVBQUFDLEdBQ0EsR0FBQTVDLEdBQUEyQyxFQUFBdEYsR0FBQXVGLEVBQUF2RixHQUFBLEdBQUFzRixFQUFBdEYsR0FBQXVGLEVBQUF2RixHQUFBLEVBQUEsQ0FDQSxPQUFBMkMsR0FBQXlDLEdBR0EsUUFBQUksR0FBQU4sR0FNQSxHQUFBTyxHQUFBUCxDQUNBLE9BQUEsVUFBQVEsRUFBQUMsR0FLQSxJQUpBLEdBQUFuRSxHQUFBLEVBQUFtQixFQUFBLEVBQUFpRCxFQUFBSCxFQUFBOUYsT0FJQSxJQUFBZ0QsR0FBQWlELEVBQUFwRSxHQUNBbUIsRUFBQXdDLEVBQUFNLEVBQUFqRSxJQUFBa0UsRUFBQUMsR0FDQW5FLEdBRUEsT0FBQW1CLElBR0EsTUFBQXNDLEdBQUExRCxLQUFBaUUsRUFBQU4iLCJmaWxlIjoiZ2VuZXJpYy50YWJsZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIhZnVuY3Rpb24oZSl7dHJ5e2U9YW5ndWxhci5tb2R1bGUoXCJnZW5lcmljLnRhYmxlXCIpfWNhdGNoKHQpe2U9YW5ndWxhci5tb2R1bGUoXCJnZW5lcmljLnRhYmxlXCIsW10pfWUucnVuKFtcIiR0ZW1wbGF0ZUNhY2hlXCIsZnVuY3Rpb24oZSl7ZS5wdXQoXCJkaXJlY3RpdmUvZ2VuZXJpYy10YWJsZS9nZW5lcmljLXRhYmxlLmh0bWxcIiwnPGRpdiBjbGFzcz1cImdlbmVyaWMtdGFibGVcIj48dGFibGUgY2xhc3M9XCJ0YWJsZSB0YWJsZS1jb25kZW5zZWQgdGFibGUtaG92ZXIgdGFibGUtc29ydGFibGVcIiBuZy1pZj1cImd0SGFzRGF0YVwiPjx0aGVhZD48dHIgbmctY2xhc3M9XCI6Omd0Um93VHJhbnNpdGlvbiA/IFxcJ2ZhZGUtaW4gYW5pbWF0ZVxcJzpcXCdcXCdcIj48dGggbmctcmVwZWF0PVwiZmllbGQgaW4gOjpndEZpZWxkcyB8IG9yZGVyQnk6XFwnY29sdW1uT3JkZXJcXCcgdHJhY2sgYnkgZmllbGQub2JqZWN0S2V5XCIgbmctc2hvdz1cIjpndFJlZnJlc2g6Z3RTZXR0aW5ncyB8IGdldFByb3BlcnR5OmZpZWxkLm9iamVjdEtleTpcXCd2aXNpYmxlXFwnXCIgbmctY2xhc3M9XCI6Z3RSZWZyZXNoOltmaWVsZC5jbGFzc05hbWVzLCAoZmllbGQub2JqZWN0S2V5IHwgY2FtZWxUb0Rhc2gpICsgXFwnLWNvbHVtblxcJywgXFwnc29ydC1cXCcrKGd0U2V0dGluZ3MgfCBnZXRQcm9wZXJ0eTpmaWVsZC5vYmplY3RLZXk6XFwnc29ydFxcJyldXCI+PHNwYW4gbmctY2xpY2s9XCI6Z3RSZWZyZXNoOihndFNldHRpbmdzIHwgZ2V0UHJvcGVydHk6ZmllbGQub2JqZWN0S2V5OlxcJ3NvcnRcXCcpID09PSBcXCdlbmFibGVcXCcgPyBzb3J0KGZpZWxkLm9iamVjdEtleSk6KGd0U2V0dGluZ3MgfCBnZXRQcm9wZXJ0eTpmaWVsZC5vYmplY3RLZXk6XFwnc29ydFxcJykgPT09IFxcJ2FzY1xcJyA/IHNvcnQoZmllbGQub2JqZWN0S2V5KTooZ3RTZXR0aW5ncyB8IGdldFByb3BlcnR5OmZpZWxkLm9iamVjdEtleTpcXCdzb3J0XFwnKSA9PT0gXFwnZGVzY1xcJyA/IHNvcnQoZmllbGQub2JqZWN0S2V5KTpcXCdcXCdcIj57ezo6ZmllbGQubmFtZX19PC9zcGFuPjwvdGg+PC90cj48dHIgbmctaWY9XCJndFRvdGFsc1wiIG5nLWNsYXNzPVwiOjpndFJvd1RyYW5zaXRpb24gPyBcXCdmYWRlLWluIGFuaW1hdGVcXCc6XFwnXFwnXCI+PHRkIG5nLXJlcGVhdD1cImZpZWxkIGluIDo6Z3RGaWVsZHMgfCBvcmRlckJ5OlxcJ2NvbHVtbk9yZGVyXFwnIHRyYWNrIGJ5IGZpZWxkLm9iamVjdEtleVwiIGNsYXNzPVwidG90YWwtY29sdW1uXCIgbmctc2hvdz1cIjpndFJlZnJlc2g6Z3RTZXR0aW5ncyB8IGdldFByb3BlcnR5OmZpZWxkLm9iamVjdEtleTpcXCd2aXNpYmxlXFwnXCIgbmctY2xhc3M9XCI6OlsoZ3RGaWVsZHMgfCBnZXRQcm9wZXJ0eTpmaWVsZC5vYmplY3RLZXk6XFwnY2xhc3NOYW1lc1xcJyksIChmaWVsZC5vYmplY3RLZXkgfCBjYW1lbFRvRGFzaCkgKyBcXCctY29sdW1uXFwnXVwiIG5nLWJpbmQtaHRtbD1cIjo6Z3RGaWVsZHMgfCBndFJlbmRlcjpndFRvdGFsczpmaWVsZC5vYmplY3RLZXlcIj48L3RkPjwvdHI+PC90aGVhZD48dGJvZHk+PHRyIG5nLXJlcGVhdD1cInJvdyBpbiBndERpc3BsYXlEYXRhIHwgbGltaXRUbzogZGlzcGxheVJvd3NcIiBndC1ldmVudD1cIlwiIG5nLWNsYXNzPVwiOjpndFJvd1RyYW5zaXRpb24gPyBcXCdmYWRlLWluIGFuaW1hdGVcXCc6XFwnXFwnXCI+PHRkIG5nLXJlcGVhdD1cImZpZWxkIGluIDo6Z3RGaWVsZHMgfCBvcmRlckJ5OlxcJ2NvbHVtbk9yZGVyXFwnIHRyYWNrIGJ5IGZpZWxkLm9iamVjdEtleVwiIG5nLXNob3c9XCI6Z3RSZWZyZXNoOmd0U2V0dGluZ3MgfCBnZXRQcm9wZXJ0eTpmaWVsZC5vYmplY3RLZXk6XFwndmlzaWJsZVxcJ1wiIG5nLWNsYXNzPVwiOjpbKGd0RmllbGRzIHwgZ2V0UHJvcGVydHk6ZmllbGQub2JqZWN0S2V5OlxcJ2NsYXNzTmFtZXNcXCcpLCAoZmllbGQub2JqZWN0S2V5IHwgY2FtZWxUb0Rhc2gpICsgXFwnLWNvbHVtblxcJ11cIj48c3BhbiBuZy1jbGFzcz1cIjo6ZmllbGQuY2xpY2sgPyBcXCdndC1jbGljay1lbmFibGVkXFwnOlxcJ1xcJ1wiIG5nLWJpbmQtaHRtbD1cIjo6Z3RGaWVsZHMgfCBndFJlbmRlcjpyb3c6ZmllbGQub2JqZWN0S2V5XCIgbmctY2xpY2s9XCI6OiFmaWVsZC5jbGljayB8fCBmaWVsZC5jbGljayhyb3cpXCI+PC9zcGFuPjwvdGQ+PC90cj48L3Rib2R5Pjx0ciBuZy1pZj1cInBhZ2luYXRpb24gPT09IGZhbHNlXCI+PHRkIGNsYXNzPVwiZ3Qtbm8tZGF0YVwiIGNvbHNwYW49XCJ7ezpndFJlZnJlc2g6KGd0U2V0dGluZ3MgfCBmaWx0ZXI6e1xcJ3Zpc2libGVcXCc6dHJ1ZX06dHJ1ZSkubGVuZ3RofX1cIj57ezo6Z3ROb0RhdGFUeHR9fTwvdGQ+PC90cj48L3RhYmxlPjxkaXYgY2xhc3M9XCJndC1wYWdpbmF0aW9uIHRleHQtY2VudGVyXCIgbmctaWY9XCJndFBhZ2luYXRpb24gPT09IHRydWUgJiYgcGFnaW5hdGlvbiAhPT0gZmFsc2VcIj48dWwgY2xhc3M9XCJwYWdpbmF0aW9uXCI+PGxpIG5nLWNsYXNzPVwie2Rpc2FibGVkOiBjdXJyZW50UGFnZSA9PT0gMH1cIiBuZy1zaG93PVwiY3VycmVudFBhZ2UgIT09IDBcIj48YnV0dG9uIGNsYXNzPVwiYnRuLWxpbmsgbGlua1wiIG5nLWNsaWNrPVwicHJldmlvdXNQYWdlKClcIiB0cmFuc2xhdGU9XCJBTEwuR0VORVJBTCNQQUdJTkFUSU9OX1BSRVZJT1VTI0JVVFRPTlwiIG5nLWRpc2FibGVkPVwiY3VycmVudFBhZ2UgPT09IDBcIj7CqyBQcmV2PC9idXR0b24+PC9saT48bGkgbmctc2hvdz1cImN1cnJlbnRQYWdlID4gM1wiPjxidXR0b24gY2xhc3M9XCJidG4tbGluayBsaW5rXCIgbmctY2xpY2s9XCJzZXRQYWdlKDApXCI+MTwvYnV0dG9uPjxzbWFsbD7igKY8L3NtYWxsPjwvbGk+PGxpIHN0eWxlPVwiZGlzcGxheTogaW5saW5lO3BhZGRpbmc6IDAgNXB4O1wiIG5nLXJlcGVhdD1cInBhZ2UgaW4gcGFnaW5hdGlvblwiIG5nLWNsYXNzPVwicGFnZSA9PT0gY3VycmVudFBhZ2UgPyBcXCdhY3RpdmVcXCc6XFwnXFwnXCI+PGJ1dHRvbiBjbGFzcz1cImJ0bi1saW5rIGxpbmtcIiBuZy1jbGljaz1cInNldFBhZ2UocGFnZSlcIj57e3BhZ2UrMX19PC9idXR0b24+PC9saT48bGkgbmctc2hvdz1cImN1cnJlbnRQYWdlICsxIDwgcGFnZXMubGVuZ3RoLTEgJiYgcGFnZXMubGVuZ3RoID4gNFwiPjxzbWFsbCBuZy1zaG93PVwiY3VycmVudFBhZ2UgKyAzIDwgcGFnZXMubGVuZ3RoXCI+4oCmPC9zbWFsbD48YnV0dG9uIGNsYXNzPVwiYnRuLWxpbmsgbGlua1wiIG5nLWNsaWNrPVwic2V0UGFnZShwYWdlcy5sZW5ndGgtMSlcIj57e3BhZ2VzLmxlbmd0aH19PC9idXR0b24+PC9saT48bGkgbmctY2xhc3M9XCJ7ZGlzYWJsZWQ6IGN1cnJlbnRQYWdlID09IHBhZ2VzLmxlbmd0aH1cIiBuZy1zaG93PVwiY3VycmVudFBhZ2UrMSAhPT0gcGFnZXMubGVuZ3RoXCI+PGJ1dHRvbiBjbGFzcz1cImJ0bi1saW5rIGxpbmtcIiBuZy1jbGljaz1cIm5leHRQYWdlKClcIiB0cmFuc2xhdGU9XCJBTEwuR0VORVJBTCNQQUdJTkFUSU9OX05FWFQjQlVUVE9OXCIgbmctZGlzYWJsZWQ9XCJjdXJyZW50UGFnZSsxID09PSBwYWdlcy5sZW5ndGhcIj5OZXh0IMK7PC9idXR0b24+PC9saT48L3VsPjwvZGl2PjwvZGl2PicpfV0pfSgpOyIsIi8qKlxuICogQG5nZG9jIGRpcmVjdGl2ZVxuICogQG5hbWUgZ2VuZXJpYy50YWJsZS5kaXJlY3RpdmU6Z2VuZXJpY1RhYmxlXG4gKiBAcmVxdWlyZXMgLy8gJ3Byb3ZpZGUgYW55IGRlcGVuZGVuY2llcyBleC4gJHNjb3BlLCB5b3UgY2FuIGhhdmUgbXVsdGlwbGUgQHJlcXVpcmVzIGxpbmVzJ1xuICpcbiAqIEByZXN0cmljdCBFXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBEZXNjcmlwdGlvbiBvZiBnZW5lcmljVGFibGUgZGlyZWN0aXZlLCBsb3JlbSBpcHN1bSBkb2xhciBzaXQgYW1ldFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nPX0gZGF0YS1hdHRyaWJ1dGUgLy8gJ2F0dHJpYnV0ZXMgdXNlZCBieSBkaXJlY3RpdmUsIHlvdSBjYW4gaGF2ZSBtdWx0aXBsZSBAcGFyYW0gbGluZXMnXG4gKlxuICogIEBleGFtcGxlIDxwcmU+XG4gKlxuICogPGdlbmVyaWMtdGFibGUgZGF0YS1hdHRyaWJ1dGU9XCJteS12YWx1ZVwiPjwvZ2VuZXJpYy10YWJsZT5cbiAqXG4gKiA8L3ByZT5cbiAqL1xuYW5ndWxhci5tb2R1bGUoJ2dlbmVyaWMudGFibGUnKS5kaXJlY3RpdmUoJ2dlbmVyaWNUYWJsZScsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBndElkOic9Z3RJZCcsXG4gICAgICAgICAgICBndFNldHRpbmdzOic9Z3RTZXR0aW5ncycsXG4gICAgICAgICAgICBndEZpZWxkczonPWd0RmllbGRzJyxcbiAgICAgICAgICAgIGd0VG90YWxzOic9Z3RUb3RhbHMnLFxuICAgICAgICAgICAgLy9ndEluZGV4Oic9Z3RJbmRleCcsXG4gICAgICAgICAgICBndERhdGE6Jz1ndERhdGEnLFxuICAgICAgICAgICAgZ3RSb3dzOidAZ3RSb3dzJyxcbiAgICAgICAgICAgIGd0Um93VHJhbnNpdGlvbjonQGd0Um93VHJhbnNpdGlvbicsXG4gICAgICAgICAgICBndFBhZ2luYXRpb246J0BndFBhZ2luYXRpb24nLFxuICAgICAgICAgICAgZ3ROb0RhdGFUeHQ6J0AnXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnZGlyZWN0aXZlL2dlbmVyaWMtdGFibGUvZ2VuZXJpYy10YWJsZS5odG1sJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBmbikge1xuXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6XCJnZW5lcmljVGFibGVDb250cm9sbGVyXCJcbiAgICB9O1xufSkuY29udHJvbGxlcignZ2VuZXJpY1RhYmxlQ29udHJvbGxlcicsZnVuY3Rpb24oJHNjb3BlLCRmaWx0ZXIsJHRpbWVvdXQsIENTViwkZG9jdW1lbnQpe1xuICAgIHZhciBvcmlnaW5hbERhdGE7IC8vIG9yaWdpbmFsIHVudG91Y2hlZCBkYXRhXG4gICAgdmFyIG1hcHBlZERhdGE7IC8vIG1hcHBlZCBkYXRhLCBhcnJheSBjb250YWluaW5nIG1hcHBlZCBrZXlzIHVzZWQgYnkgdGFibGVcbiAgICB2YXIgc29ydGVkRGF0YTsgLy8gc29ydGVkIG1hcHBlZCBkYXRhXG4gICAgdmFyIHNvcnRpbmcgPSBbXTsgLy8gYXJyYXkgY29udGFpbmluZyBzb3J0aW5nIGNyaXRlcmlhc1xuICAgICRzY29wZS5ndFBhZ2luYXRpb24gPSB0eXBlb2YgJHNjb3BlLmd0UGFnaW5hdGlvbiA9PT0gJ3VuZGVmaW5lZCcgPyB0cnVlOiRzY29wZS5ndFBhZ2luYXRpb24gIT09ICdmYWxzZSc7XG4gICAgJHNjb3BlLmd0Um93cyA9IHR5cGVvZiAkc2NvcGUuZ3RSb3dzID09PSAndW5kZWZpbmVkJyA/IDIwOiRzY29wZS5ndFJvd3M7XG4gICAgJHNjb3BlLmd0Tm9EYXRhVHh0ID0gdHlwZW9mICRzY29wZS5ndE5vRGF0YVR4dCA9PT0gJ3VuZGVmaW5lZCcgPyAnTm8gdGFibGUgZGF0YSB0byBkaXNwbGF5Jzokc2NvcGUuZ3ROb0RhdGFUeHQ7XG4gICAgJHNjb3BlLmd0SWQgPSB0eXBlb2YgJHNjb3BlLmd0SWQgPT09ICd1bmRlZmluZWQnID8gJHNjb3BlLiRpZDokc2NvcGUuZ3RJZDtcbiAgICAvKiRzY29wZS50YWJsZSA9IHtcbiAgICAgaW5kZXg6JHNjb3BlLmd0SW5kZXgsXG4gICAgIHNldHRpbmdzOiAkc2NvcGUuZ3RTZXR0aW5ncyxcbiAgICAgdG90YWxzOiAkc2NvcGUuZ3RUb3RhbHMsXG4gICAgIGZpZWxkczokc2NvcGUuZ3RGaWVsZHNcbiAgICAgfTsqL1xuXG4gICAgLy8gb3JkZXIgY29sdW1uc1xuICAgICRmaWx0ZXIoJ21hcCcpKCRzY29wZS5ndFNldHRpbmdzLGZ1bmN0aW9uKHNldHRpbmcpe1xuICAgICAgICB0cnl7JGZpbHRlcignZmlsdGVyJykoJHNjb3BlLmd0RmllbGRzLHtvYmplY3RLZXk6c2V0dGluZy5vYmplY3RLZXl9LHRydWUpWzBdLmNvbHVtbk9yZGVyID0gc2V0dGluZy5jb2x1bW5PcmRlcjt9IGNhdGNoKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZmllbGQgZGVmaW5pdGlvbiBvYmplY3QgZm9yIHByb3BlcnR5OiBcIicrIHNldHRpbmcub2JqZWN0S2V5ICsnXCIgbm90IGZvdW5kLicsZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICB9KTtcblxuICAgIHZhciBpbml0VGFibGUgPSBmdW5jdGlvbihpbml0RGF0YSl7XG4gICAgICAgICRzY29wZS5ndEhhc0RhdGEgPSBmYWxzZTtcbiAgICAgICAgb3JpZ2luYWxEYXRhID0gaW5pdERhdGEuc2xpY2UoMCk7XG4gICAgICAgICRzY29wZS4kZW1pdCgnZ3Qtc3RhcnRlZC1kYXRhLXByb2Nlc3NpbmcnLCRzY29wZS5ndElkKTtcbiAgICAgICAgYXBwbHlGaWx0ZXIoaW5pdERhdGEpO1xuICAgIH07XG5cbiAgICAvLyBjaGFuZ2UgZGF0YSwgdGhpcyB3ZSB1cGRhdGUgb3IgZGF0YSBzZXRcbiAgICB2YXIgY2hhbmdlRGF0YSA9IGZ1bmN0aW9uKG5ld0RhdGEpe1xuICAgICAgICAkc2NvcGUuZ3RIYXNEYXRhID0gZmFsc2U7XG4gICAgICAgIG9yaWdpbmFsRGF0YSA9IG5ld0RhdGEuc2xpY2UoMCk7XG4gICAgICAgICRzY29wZS4kZW1pdCgnZ3Qtc3RhcnRlZC1kYXRhLXByb2Nlc3NpbmcnLCRzY29wZS5ndElkKTtcbiAgICAgICAgYXBwbHlGaWx0ZXIobmV3RGF0YSk7XG4gICAgfTtcblxuICAgIC8vIGludGVybmFsIGZpbHRlciwgdGhpcyBpcyB3aGVyZSB3ZSBhcHBseSBmaWx0ZXJzXG4gICAgdmFyIGFwcGx5RmlsdGVyID0gZnVuY3Rpb24gKGRhdGEpe1xuICAgICAgICB2YXIgZmlsdGVyZWREYXRhID0gZGF0YTtcbiAgICAgICAgbWFwS2V5cyhmaWx0ZXJlZERhdGEpO1xuICAgICAgICBmaWx0ZXJlZERhdGEubGVuZ3RoID0gMDtcbiAgICB9O1xuXG4gICAgLy8gbWFwcGluZywgdGhpcyBpcyB3aGVyZSB3ZSBtYXAgd2hpY2gga2V5cyBzaG91bGQgYmUgcGFydCBvZiB0aGUgdGFibGUgYXJyYXkgcm93IG9iamVjdFxuICAgIHZhciBtYXBLZXlzID0gZnVuY3Rpb24gKGRhdGEpe1xuXG4gICAgICAgIC8vIGdldCBrZXkgbmFtZXMgZnJvbSBzZXR0aW5nc1xuICAgICAgICB2YXIgcHJvcGVydGllcyA9ICRmaWx0ZXIoJ21hcCcpKCRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5ndFNldHRpbmdzLCB7ZW5hYmxlZDp0cnVlfSx0cnVlKSwnb2JqZWN0S2V5Jyk7XG5cbiAgICAgICAgLy8gY3JlYXRlIG5ldyBhcnJheSB3aXRoIG1hcHBlZCBkYXRhXG4gICAgICAgIG1hcHBlZERhdGEgPSAkZmlsdGVyKCdtYXAnKShkYXRhLCBmdW5jdGlvbihyb3cpe1xuICAgICAgICAgICAgdmFyIG9iaiA9IHt9OyAvLyBjcmVhdGUgbmV3IHJvdyBvYmplY3RcblxuICAgICAgICAgICAgLy8gcmV0cmlldmUgb2JqZWN0IHZhbHVlcyBmcm9tIHJvdyBhbmQgYWRkIHRoZW0gdG8gdGhlIGNvcnJlc3BvbmRpbmcga2V5IGRlZmluZWQgYnkgdGhlIHRhYmxlIGZpZWxkc1xuICAgICAgICAgICAgJGZpbHRlcignbWFwJykocHJvcGVydGllcyxmdW5jdGlvbihwcm9wZXJ0eSl7XG4gICAgICAgICAgICAgICAgLy8gaWYgcHJvcGVydHkgZXhpc3RzIGluIGRhdGEgb2JqZWN0Li4uXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHJvd1twcm9wZXJ0eV0gIT09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGNvbHVtbiB2YWx1ZSBmcm9tIGRhdGEgcHJvcGVydHlcbiAgICAgICAgICAgICAgICAgICAgb2JqW3Byb3BlcnR5XT1yb3dbcHJvcGVydHldXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygncHJvcGVydHk6IFwiJyArIHByb3BlcnR5ICArICdcIiBkb2VzIG5vdCBleGlzdCBpbiBkYXRhIG9iamVjdCwgYXR0ZW1wdGluZyB0byB1c2UgdmFsdWUgZnVuY3Rpb24gaW5zdGVhZCAnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gcHJvcGVydHkgZG9lcyBub3QgZXhpc3RzIGluIGRhdGEsIHVzZSB2YWx1ZSBmdW5jdGlvbiB0byBnZXQgdmFsdWUgZm9yIGNvbHVtblxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVGdW5jdGlvbiA9ICRmaWx0ZXIoJ21hcCcpKCRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5ndEZpZWxkcywge29iamVjdEtleTpwcm9wZXJ0eX0sdHJ1ZSksJ3ZhbHVlJylbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlRnVuY3Rpb24gJiYgYW5ndWxhci5pc0Z1bmN0aW9uKHZhbHVlRnVuY3Rpb24pKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZSBjdXN0b20gdmFsdWUgZnVuY3Rpb24gdG8gcmV0cmlldmUgdmFsdWUgZm9yIGNvbHVtblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygndXNpbmcgdmFsdWUgZnVuY3Rpb24gdG8gZ2V0IGRhdGEgZm9yIHJvdyBjb2x1bW4gJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbcHJvcGVydHldID0gdmFsdWVGdW5jdGlvbihyb3cpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb3BlcnR5OiBcIicgKyBwcm9wZXJ0eSAgKyAnXCIgZG9lcyBub3QgZXhpc3RzIGluIGRhdGEgb2JqZWN0IGFuZCBubyB2YWx1ZSBmdW5jdGlvbiB3YXMgZGVjbGFyZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGFwcGx5IHNvcnQgdG8gb3VyIG1hcHBlZCBhcnJheVxuICAgICAgICBhcHBseVNvcnQoKTtcbiAgICB9O1xuXG4gICAgLy8gc29ydCwgdGhpcyBpcyB3aGVyZSB3ZSBzb3J0IHRoZSBmaWx0ZXJlZCByZXN1bHRzXG4gICAgdmFyIGFwcGx5U29ydCA9IGZ1bmN0aW9uICgpe1xuICAgICAgICBzb3J0ZWREYXRhID0gJGZpbHRlcignZ3RTb3J0JykobWFwcGVkRGF0YSwgc29ydGluZyk7XG4gICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCckJHJlYmluZDo6Z3RSZWZyZXNoJyk7XG4gICAgICAgIGFwcGx5UGFnaW5hdGlvbigpO1xuICAgIH07XG5cbiAgICAvLyBwYWdpbmF0aW9uLCB0aGlzIGlzIHdoZXJlIHdlIGRlY2lkZSB3aGljaCBzdWJzZXQgb2YgdGhlIGRhdGEgdG8gc2hvd1xuICAgIHZhciBhcHBseVBhZ2luYXRpb24gPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgJHNjb3BlLnBhZ2VzID0gJGZpbHRlcignY2h1bmtCeScpKHNvcnRlZERhdGEsIHBhcnNlSW50KCRzY29wZS5ndFJvd3MpKTtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gMDtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuJGVtaXQoJ2d0LXN0YXJ0ZWQtcmVuZGVyaW5nJyk7XG4gICAgICAgICRzY29wZS5ndERpc3BsYXlEYXRhID0gJHNjb3BlLnBhZ2VzWyRzY29wZS5jdXJyZW50UGFnZV07XG4gICAgICAgIHBhZ2luYXRpb24oJHNjb3BlLnBhZ2VzLmxlbmd0aCwkc2NvcGUuY3VycmVudFBhZ2UpO1xuXG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2d0LWZpbmlzaGVkLWRhdGEtcHJvY2Vzc2luZycsJHNjb3BlLmd0SWQpO1xuICAgICAgICAgICAgJHNjb3BlLmd0SGFzRGF0YSA9IHRydWU7XG4gICAgICAgIH0sMjAwKTtcbiAgICAgICAgLy8kc2NvcGUuJGVtaXQoJ2d0LWZpbmlzaGVkLXJlbmRlcmluZycpO1xuICAgICAgICAvKmlmKCRzY29wZS5sb2FkaW5nKXtcbiAgICAgICAgIGNvbnNvbGUubG9nKCdzdGlsbCBsb29hZGluZycpO1xuICAgICAgICAgJHNjb3BlLiRlbWl0KCdndC1maW5pc2hlZC1yZW5kZXJpbmcnKTtcbiAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICB9Ki9cbiAgICB9O1xuXG4gICAgLy8gbGlzdGVuIGZvciB1cGRhdGUgdGFibGUgZXZlbnRzXG4gICAgJHNjb3BlLiRvbignZ3QtdXBkYXRlLXRhYmxlOicrJHNjb3BlLmd0SWQsZnVuY3Rpb24oZXZlbnQsYXJnKXtcbiAgICAgICAgY2hhbmdlRGF0YShhcmcpO1xuICAgIH0pO1xuXG4gICAgLy8gbGlzdGVuIGZvciB1cGRhdGUgdGFibGUgZXZlbnRzXG4gICAgJHNjb3BlLiRvbignZ3QtdXBkYXRlLXN0cnVjdHVyZTonKyRzY29wZS5ndElkLGZ1bmN0aW9uKGV2ZW50LGFyZyl7XG4gICAgICAgICRzY29wZS5ndEZpZWxkcyA9IGFyZy5maWVsZHM7XG4gICAgICAgICRzY29wZS5ndFNldHRpbmdzID0gYXJnLnNldHRpbmdzO1xuICAgIH0pO1xuXG5cbiAgICAvLyBsaXN0ZW4gZm9yIHBhZ2luYXRpb24gbGVuZ3RoIGNoYW5nZVxuICAgICRzY29wZS4kb24oJ2d0LXBhZ2luYXRlLXRhYmxlOicrJHNjb3BlLmd0SWQsZnVuY3Rpb24oZXZlbnQsYXJnKXtcbiAgICAgICAgJHNjb3BlLmd0Um93cyA9IHBhcnNlSW50KGFyZyk7XG4gICAgICAgIGFwcGx5UGFnaW5hdGlvbigpO1xuICAgIH0pO1xuXG4gICAgLy8gbGlzdGVuIGZvciBleHBvcnQgZXZlbnRcbiAgICAkc2NvcGUuJG9uKCdndC1leHBvcnQtY3N2OicrJHNjb3BlLmd0SWQsZnVuY3Rpb24oZXZlbnQsYXJnKXtcbiAgICAgICAgZ3RFeHBvcnQoYXJnKTtcbiAgICB9KTtcblxuXG4gICAgLy8gY3JlYXRlIHBhZ2luYXRpb25cbiAgICB2YXIgcGFnaW5hdGlvbiA9IGZ1bmN0aW9uKHRvdGFsUGFnZXMsIGN1cnJlbnRQYWdlKXtcbiAgICAgICAgJHNjb3BlLnBhZ2luYXRpb24gPSBbXTtcblxuICAgICAgICAvLyBpZiB0b3RhbCBwYWdlcyBlcXVhbHMgMCBpZS4gbm8gZGF0YSBhdmFpbGFibGVcbiAgICAgICAgaWYodG90YWxQYWdlcyA9PT0gMCApIHtcbiAgICAgICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiBsZXNzIHRoYW4gdHdvIHBhZ2VzXG4gICAgICAgIGlmKHRvdGFsUGFnZXMgPCAyKXtcbiAgICAgICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0gWzBdO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIGxlc3MgdGhhbiB0aHJlZSBwYWdlc1xuICAgICAgICBlbHNlIGlmKHRvdGFsUGFnZXMgPCAzKXtcbiAgICAgICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0gWzAsMV07XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgbGVzcyB0aGFuIGZvdXIgcGFnZXNcbiAgICAgICAgZWxzZSBpZih0b3RhbFBhZ2VzIDwgNCl7XG4gICAgICAgICAgICAkc2NvcGUucGFnaW5hdGlvbiA9IFswLDEsMl07XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgbGVzcyB0aGFuIGZpdmUgcGFnZXNcbiAgICAgICAgZWxzZSBpZih0b3RhbFBhZ2VzIDwgNSl7XG4gICAgICAgICAgICAkc2NvcGUucGFnaW5hdGlvbiA9IFswLDEsMiwzXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBjdXJyZW50IHBhZ2UgaXMgb25lIG9mIHRoZSBmb3VyIGZpcnN0IHBhZ2VzXG4gICAgICAgIGVsc2UgaWYoY3VycmVudFBhZ2UgPCA0KXtcbiAgICAgICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0gWzAsMSwyLDMsNF07XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgbmV4dCB0byBsYXN0IHBhZ2VcbiAgICAgICAgZWxzZSBpZih0b3RhbFBhZ2VzID4gY3VycmVudFBhZ2UrMSl7XG4gICAgICAgICAgICAkc2NvcGUucGFnaW5hdGlvbiA9IFtjdXJyZW50UGFnZS0xLGN1cnJlbnRQYWdlLGN1cnJlbnRQYWdlKzFdO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIGxhc3QgcGFnZVxuICAgICAgICBlbHNlIGlmKHRvdGFsUGFnZXMgPT09IGN1cnJlbnRQYWdlKzEpe1xuICAgICAgICAgICAgJHNjb3BlLnBhZ2luYXRpb24gPSBbY3VycmVudFBhZ2UtMixjdXJyZW50UGFnZS0xLGN1cnJlbnRQYWdlXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBjdXJyZW50IHBhZ2UgaXMgbm90IG9uZSBvZiB0aGUgZm91ciBmaXJzdCBwYWdlc1xuICAgICAgICBlbHNlIGlmKHRvdGFsUGFnZXMtNCA+IGN1cnJlbnRQYWdlKXtcbiAgICAgICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0gW2N1cnJlbnRQYWdlLTEsY3VycmVudFBhZ2UsY3VycmVudFBhZ2UrMSwgY3VycmVudFBhZ2UrMl07XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLm5leHRQYWdlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSArKztcbiAgICAgICAgICAgIHBhZ2luYXRpb24oJHNjb3BlLnBhZ2VzLmxlbmd0aCwkc2NvcGUuY3VycmVudFBhZ2UpO1xuICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdndC1zdGFydGVkLXJlbmRlcmluZycsJHNjb3BlLmd0SWQpO1xuICAgICAgICAgICAgJHNjb3BlLmd0RGlzcGxheURhdGEgPSAkc2NvcGUucGFnZXNbJHNjb3BlLmN1cnJlbnRQYWdlXTtcbiAgICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgJHNjb3BlLnByZXZpb3VzUGFnZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRzY29wZS5jdXJyZW50UGFnZSAtLTtcbiAgICAgICAgcGFnaW5hdGlvbigkc2NvcGUucGFnZXMubGVuZ3RoLCRzY29wZS5jdXJyZW50UGFnZSk7XG4gICAgICAgICRzY29wZS4kZW1pdCgnZ3Qtc3RhcnRlZC1yZW5kZXJpbmcnLCRzY29wZS5ndElkKTtcbiAgICAgICAgJHNjb3BlLmd0RGlzcGxheURhdGEgPSAkc2NvcGUucGFnZXNbJHNjb3BlLmN1cnJlbnRQYWdlXTtcbiAgICB9O1xuICAgICRzY29wZS5zZXRQYWdlID0gZnVuY3Rpb24ocGFnZSl7XG4gICAgICAgICRzY29wZS5jdXJyZW50UGFnZSA9IHBhZ2U7XG4gICAgICAgIHBhZ2luYXRpb24oJHNjb3BlLnBhZ2VzLmxlbmd0aCwkc2NvcGUuY3VycmVudFBhZ2UpO1xuICAgICAgICAkc2NvcGUuJGVtaXQoJ2d0LXN0YXJ0ZWQtcmVuZGVyaW5nJywkc2NvcGUuZ3RJZCk7XG4gICAgICAgICRzY29wZS5ndERpc3BsYXlEYXRhID0gJHNjb3BlLnBhZ2VzWyRzY29wZS5jdXJyZW50UGFnZV07XG4gICAgfTtcblxuICAgIC8vIHNvcnQgZnVuY3Rpb25cbiAgICAkc2NvcGUuc29ydCA9IGZ1bmN0aW9uKHByb3BlcnR5KXtcbiAgICAgICAgaWYgKHByb3BlcnR5KXtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyAkc2NvcGUuZ3RTZXR0aW5ncy5sZW5ndGggPiBpOyBpKyspe1xuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5nID0gJHNjb3BlLmd0U2V0dGluZ3NbaV07XG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZy5vYmplY3RLZXkgPT09IHByb3BlcnR5KXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNvcnQgPSBzZXR0aW5nLnNvcnQ7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc29ydCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlbmFibGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ndFNldHRpbmdzW2ldLnNvcnQgPSAnYXNjJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FzYyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmd0U2V0dGluZ3NbaV0uc29ydCA9ICdkZXNjJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Rlc2MnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ndFNldHRpbmdzW2ldLnNvcnQgPSAnZW5hYmxlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgc29ydGluZyA9ICRmaWx0ZXIoJ21hcCcpKCRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5ndFNldHRpbmdzLHtzb3J0OlwiYXNjIGRlc2NcIn0sZnVuY3Rpb24oZXhwZWN0ZWQsIGFjdHVhbCl7XG4gICAgICAgICAgICByZXR1cm4gYWN0dWFsLmluZGV4T2YoZXhwZWN0ZWQpID4gLTE7XG4gICAgICAgIH0pLGZ1bmN0aW9uKHNvcnQpe1xuICAgICAgICAgICAgcmV0dXJuIChzb3J0LnNvcnQgPT09ICdkZXNjJyA/ICctJzonJykgKyBzb3J0Lm9iamVjdEtleVxuICAgICAgICB9KTtcblxuICAgICAgICBhcHBseVNvcnQoKTtcbiAgICB9O1xuXG4gICAgLy8gaWYgdGFibGUgaGFzIGRhdGEgdXBvbiBpbml0aWFsaXphdGlvbi4uLlxuICAgIGlmKCRzY29wZS5ndERhdGEpe1xuICAgICAgICBpbml0VGFibGUoJHNjb3BlLmd0RGF0YSk7IC8vIGluaXRpYWxpemUgdGFibGUgd2l0aCBkYXRhIHBhc3NlZCB0byBkaXJlY3RpdmVcbiAgICB9XG5cbiAgICAvLyBleHBvcnQgZnVuY3Rpb25cbiAgICB2YXIgZ3RFeHBvcnQgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSAndW5kZWZpbmVkJz8ge306b3B0aW9ucztcblxuICAgICAgICB2YXIgZmlsZU5hbWUgPSB0eXBlb2Ygb3B0aW9ucy5maWxlTmFtZSA9PT0gJ3VuZGVmaW5lZCcgPyAnZXhwb3J0JzpvcHRpb25zLmZpbGVOYW1lO1xuICAgICAgICAvLyBkZWNsYXJlIGV4cG9ydCBkYXRhXG4gICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShhbmd1bGFyLnRvSnNvbihzb3J0ZWREYXRhLnNsaWNlKDApKSk7XG4gICAgICAgIHZhciBoZWFkZXJzID0ge1xuICAgICAgICAgICAgZmllbGRTZXA6IHR5cGVvZiBvcHRpb25zLmZpZWxkU2VwID09PSAndW5kZWZpbmVkJyA/IFwiO1wiOm9wdGlvbnMuZmllbGRTZXAsXG4gICAgICAgICAgICBoZWFkZXI6ICRmaWx0ZXIoJ21hcCcpKCRmaWx0ZXIoJ29yZGVyQnknKSgkc2NvcGUuZ3RGaWVsZHMsXCJjb2x1bW5PcmRlclwiKSxcIm5hbWVcIiksIC8vIGdldCBoZWFkZXJzIGJ5IGNvbHVtbiBvcmRlclxuICAgICAgICAgICAgdHh0RGVsaW06IHR5cGVvZiBvcHRpb25zLnR4dERlbGltID09PSAndW5kZWZpbmVkJyA/ICdcIic6b3B0aW9ucy50eHREZWxpbSxcbiAgICAgICAgICAgIGNvbHVtbk9yZGVyOiRmaWx0ZXIoJ21hcCcpKCRmaWx0ZXIoJ29yZGVyQnknKSgkc2NvcGUuZ3RGaWVsZHMsXCJjb2x1bW5PcmRlclwiKSxcIm9iamVjdEtleVwiKSwgLy8gZ2V0IGNvbHVtbiBvcmRlclxuICAgICAgICAgICAgZGVjaW1hbFNlcDp0eXBlb2Ygb3B0aW9ucy5kZWNpbWFsU2VwID09PSAndW5kZWZpbmVkJyA/ICcsJzpvcHRpb25zLmRlY2ltYWxTZXAsXG4gICAgICAgICAgICBhZGRCeXRlT3JkZXJNYXJrZXI6dHlwZW9mIG9wdGlvbnMuYWRkQm9tID09PSAndW5kZWZpbmVkJyxcbiAgICAgICAgICAgIGNoYXJzZXQ6dHlwZW9mIG9wdGlvbnMuY2hhcnNldCA9PT0gJ3VuZGVmaW5lZCcgPyAndXRmLTgnOm9wdGlvbnMuY2hhcnNldFxuICAgICAgICB9O1xuICAgICAgICBDU1Yuc3RyaW5naWZ5KGRhdGEsIGhlYWRlcnMpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblxuICAgICAgICAgICAgdmFyIGJsb2I7XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcbiAgICAgICAgICAgICAgICBibG9iID0gbmV3IEJsb2IoW3Jlc3VsdF0sIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04O1wiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbmF2aWdhdG9yLm1zU2F2ZUJsb2IoYmxvYiwgJ2V4cG9ydC5jc3YnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgbm90IGEgZnVsbHkgd29ya2luZyBzb2x1dGlvbiwgc29tZSB0YWdzICh0ZXggPEJPRFk+KSBzaG93IHVwIGluIGV4Y2VsIHRvZ2V0aGVyIHdpdGggdGhlIGNvcnJlY3QgZGF0YS5cbiAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIGFkZGVkIGFuIGFsZXJ0IG1lc3NhZ2UgdG8gdXJnZSB1c2VycyB0byB1c2UgYW5vdGhlciBicm93c2VyIG9yIHVwZGF0ZSB0aGVpciBicm93c2VyIGZvciBhIGJldHRlciBsb29raW5nIGV4cG9ydC5cbiAgICAgICAgICAgICAgICBpZiAod2luZG93Lm5hdmlnYXRvci5hcHBOYW1lID09PSAnTWljcm9zb2Z0IEludGVybmV0IEV4cGxvcmVyJykge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoXCJZb3UncmUgdXNpbmcgYW4gb2xkIHZlcnNpb24gb2YgSW50ZXJuZXQgRXhwbG9yZXIgYW5kIHRoZSBleHBvcnQgbWlnaHQgdGhlcmVmb3JlIGhhdmUgdGhlIHdyb25nIGZvcm1hdCwgcGxlYXNlIHVwZGF0ZSB5b3VyIGJyb3dzZXIuXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWZyYW1lID0gYW5ndWxhci5lbGVtZW50KCc8aWZyYW1lPjwvaWZyYW1lPicpO1xuICAgICAgICAgICAgICAgICAgICBpZnJhbWVbMF0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudCgnYm9keScpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZChpZnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYyA9IGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmIChpZnJhbWVbMF0uY29udGVudFdpbmRvdyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb2MgPSBpZnJhbWVbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkb2Mub3BlbihcInRleHQvcGxhaW5cIiwgXCJyZXBsYWNlXCIpO1xuICAgICAgICAgICAgICAgICAgICBkb2Mud3JpdGUoW3Jlc3VsdF0pO1xuICAgICAgICAgICAgICAgICAgICBkb2MuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgLy9pZnJhbWUuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jLmV4ZWNDb21tYW5kKCdTYXZlQXMnLCB0cnVlLCBmaWxlTmFtZSsnLmNzdicpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBibG9iID0gbmV3IEJsb2IoW3Jlc3VsdF0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dC9jc3Y7Y2hhcnNldD11dGYtODtcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkTGluayA9IGFuZ3VsYXIuZWxlbWVudCgnPGE+PC9hPicpO1xuICAgICAgICAgICAgICAgICAgICBkb3dubG9hZExpbmsuYXR0cignaHJlZicsIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcbiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rLmF0dHIoJ2Rvd25sb2FkJyxmaWxlTmFtZSsnLmNzdicpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZCBkb3dubG9hZCBsaW5rIHRvIGJvZHkgYW5kIGNsaWNrIGl0LCBvbmNlIGNsaWNrZWQgcmVtb3ZlIGl0XG4gICAgICAgICAgICAgICAgICAgICRkb2N1bWVudC5maW5kKCdib2R5JykuYXBwZW5kKGRvd25sb2FkTGluayk7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZExpbmtbMF0uY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkTGluay5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH07XG5cbn0pLmRpcmVjdGl2ZSgnZ3RFdmVudCcsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgZm4pIHtcbiAgICAgICAgICAgIGlmIChzY29wZS4kbGFzdCl7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGVtaXQoJ2d0LWZpbmlzaGVkLXJlbmRlcmluZycsc2NvcGUuZ3RJZCk7XG4gICAgICAgICAgICAgICAgLy9zY29wZS4kcGFyZW50LiRwYXJlbnQubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn0pLmZpbHRlcignZ2V0UHJvcGVydHknLGZ1bmN0aW9uKCRmaWx0ZXIpe1xuICAgIHJldHVybiBmdW5jdGlvbihzZXR0aW5ncywga2V5LHByb3BlcnR5KXtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhrZXkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIG91dHB1dCA9ICRmaWx0ZXIoJ2ZpbHRlcicpKHNldHRpbmdzLHtvYmplY3RLZXk6a2V5fSx0cnVlKVswXVtwcm9wZXJ0eV07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2Fubm90IHJlYWQgcHJvcGVydHk6IFwiJyArIHByb3BlcnR5ICsgJ1wiIG9uIG1pc3Npbmcga2V5OiBcIicgKyBrZXkgKyAnXCIgaW4gc2V0dGluZ3MuJywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxufSkuZmlsdGVyKCdndFJlbmRlcicsZnVuY3Rpb24oJGZpbHRlcil7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHNldHRpbmdzLCByb3csIGtleSl7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ3JlbmRlcicpO1xuICAgICAgICB2YXIgb3V0cHV0O1xuICAgICAgICAvL3ZhciBvdXRwdXQgPSBhbmd1bGFyLmlzQXJyYXkoc2V0dGluZ3MpID8gJGZpbHRlcignZmlsdGVyJykoc2V0dGluZ3Mse29iamVjdEtleTprZXl9LHRydWUpWzBdW2tleV06IHJvd1trZXldO1xuICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KHNldHRpbmdzKSkge1xuICAgICAgICAgICAgdmFyIHJlbmRlck1ldGhvZCA9ICRmaWx0ZXIoJ2ZpbHRlcicpKHNldHRpbmdzLHtvYmplY3RLZXk6a2V5fSx0cnVlKVswXS5yZW5kZXI7XG4gICAgICAgICAgICBpZihyZW5kZXJNZXRob2QgJiYgYW5ndWxhci5pc0Z1bmN0aW9uKHJlbmRlck1ldGhvZCkpe1xuICAgICAgICAgICAgICAgIG91dHB1dCA9IHJlbmRlck1ldGhvZChyb3csIGtleSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG91dHB1dCA9IHJvd1trZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb3V0cHV0ID0gcm93W2tleV07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cbn0pLmZpbHRlcignY2FtZWxUb0Rhc2gnLGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmluZyl7XG4gICAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSggLyhbYS16XSkoW0EtWl0pL2csICckMS0kMicgKS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbn0pLmZpbHRlcignZ3RTb3J0JyxmdW5jdGlvbigpe1xuICAgIHJldHVybiBmdW5jdGlvbihhcnJheSwgcHJvcGVydHlBcnJheSl7XG4gICAgICAgIGZ1bmN0aW9uIGR5bmFtaWNTb3J0KHByb3BlcnR5KSB7XG4gICAgICAgICAgICB2YXIgc29ydE9yZGVyID0gMTtcbiAgICAgICAgICAgIGlmKHByb3BlcnR5WzBdID09PSBcIi1cIikge1xuICAgICAgICAgICAgICAgIHNvcnRPcmRlciA9IC0xO1xuICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gcHJvcGVydHkuc3Vic3RyKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLGIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gKGFbcHJvcGVydHldIDwgYltwcm9wZXJ0eV0pID8gLTEgOiAoYVtwcm9wZXJ0eV0gPiBiW3Byb3BlcnR5XSkgPyAxIDogMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0ICogc29ydE9yZGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGR5bmFtaWNTb3J0TXVsdGlwbGUocHJvcGVydHlBcnJheSkge1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAqIHNhdmUgdGhlIGFyZ3VtZW50cyBvYmplY3QgYXMgaXQgd2lsbCBiZSBvdmVyd3JpdHRlblxuICAgICAgICAgICAgICogbm90ZSB0aGF0IGFyZ3VtZW50cyBvYmplY3QgaXMgYW4gYXJyYXktbGlrZSBvYmplY3RcbiAgICAgICAgICAgICAqIGNvbnNpc3Rpbmcgb2YgdGhlIG5hbWVzIG9mIHRoZSBwcm9wZXJ0aWVzIHRvIHNvcnQgYnlcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdmFyIHByb3BzID0gcHJvcGVydHlBcnJheTsgLy9hcmd1bWVudHM7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG9iajEsIG9iajIpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDAsIHJlc3VsdCA9IDAsIG51bWJlck9mUHJvcGVydGllcyA9IHByb3BzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAvKiB0cnkgZ2V0dGluZyBhIGRpZmZlcmVudCByZXN1bHQgZnJvbSAwIChlcXVhbClcbiAgICAgICAgICAgICAgICAgKiBhcyBsb25nIGFzIHdlIGhhdmUgZXh0cmEgcHJvcGVydGllcyB0byBjb21wYXJlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgd2hpbGUocmVzdWx0ID09PSAwICYmIGkgPCBudW1iZXJPZlByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZHluYW1pY1NvcnQocHJvcHNbaV0pKG9iajEsIG9iajIpO1xuICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5LnNvcnQoZHluYW1pY1NvcnRNdWx0aXBsZShwcm9wZXJ0eUFycmF5KSk7XG4gICAgfVxufSk7XG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
